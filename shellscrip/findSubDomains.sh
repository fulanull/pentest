#!/bin/bash

#echo $0" :"$1" #"$2"  pwd $(pwd)" 
if [ -z $1 ]
then
	echo "Para achar os subdominions de um site, use o programa dessa forma:"
	echo "$0 businesscorp.com.br"
else
	depth=$2
	if [ -z $depth ]
	then 
		depth=0
	fi
#	echo "Search started:i"
	prefixstr=$(echo $1 | awk -F '://' '{print $2}')
	posfixstr=cobaiaFile.txt
#	echo "valor do awk: $prefixstr"
	if [ -z $prefixstr  ]
	then
		outputFile=$1$posfixstr
	else
		outputFile=$prefixstr$posfixstr
	fi
	command="wget $1 -q -O $outputFile"
#	echo "Comando: "$command
	eval $command
	cat $outputFile | egrep "href=|src" | grep -v "\"#" | grep -v "src=\"" | grep -v "rel=" | grep "/" | awk -F '//' '{print $2}'| cut -d '"' -f1 | cut -d '/' -f1 | sort -u > 2$outputFile
	for aux in $(cat 2$outputFile);
	do
		resul=$( host $aux | grep "has addr" | awk -F ' ' '{print $1 "\tip:" $4}' )
		if ! [ -z "$resul" ]
		then
			echo $resul
			if [ $depth -gt 0 ]
			then
				temp=$(( depth -1 ))
#				echo "Depth= $depth \$2=$2 Temp = $temp"
				temp=$0" "$aux" "$temp
#				echo "Recursivo: $temp"
				eval $temp
			fi
		else
              		echo "Fail: $aux"
                fi
	done
	
	rm 2$outputFile
	rm $outputFile
fi
