/*
 ============================================================================
 Name        : SocketInC.c
 Author      : Igor Souza
 Version     :
 Copyright   : Your copyright notice
 Description : PortScan
 ============================================================================
 */

#include <stdio.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <netdb.h>



int scanPorts(char address[], int portFrom, int portUpTo)
{



	int i=0;
	struct sockaddr_in target;
	int tcp_socket;
	int connection=0;
	printf("\Scanning %s ports from %d up to %d ....\n", address, portFrom, portUpTo);
	for (i = portFrom; i <= portUpTo && i <=0xffff; ++i)
	{


		tcp_socket = socket(AF_INET, SOCK_STREAM, 0);
		if(tcp_socket == -1 )
		{
			fprintf(stderr,"%s:%d : ", __FILE__, __LINE__);
			fprintf(stderr, "Socket creation failed!!!\n");
			return -1;
		}

//		printf( "\nPort %d is", i);
		memset(&target, 0x00, sizeof(target));
		target.sin_family = AF_INET;
		target.sin_addr.s_addr = inet_addr(address);
		target.sin_port = htons(i);
		connection = connect(tcp_socket,(struct sockaddr *) &target, sizeof(target));
		if( connection != 0 )
		{
//			printf( "\nPort %d is CLOSED!",i);
//			return -1;
		}
		else
		{
			printf( "\nPort %d is OPEN!",i);
		}
		close(tcp_socket);
	}

	return 0;
}
